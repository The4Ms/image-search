<html>
<head>
	<script src="search-request.js"></script>
	<script src="search-results.js"></script>
	<script src="image-split.js"></script>
	
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.1.2/mustache.js"></script>
	
	<script>
		function onSubmitSearch(){
			try{
				var imageInputControl = document.getElementById('image');
				var searchImage = new Image();

				loadSearchImageAsDataURI(imageInputControl, searchImage, function(){

					// send request to the server
					doSearchRequest(imageInputControl, function(searchResults){

						// split the objects found in the search image 
						for(var i=0; i<searchResults.foundObjects.length; i++){
							var objectBounds = searchResults.foundObjects[i];
							var splittedImageDataURI = getSubImage(searchImage, objectBounds);

							searchResults.foundObjects[i].extractedImageUrl = splittedImageDataURI;
						}

						showResults(searchResults);
					});
				});
			}
			catch(e){
				console.log(e);
			}
			return false;
		}
	</script>
	
	<script id="resultTemplate" type="x-tmpl-mustache">
	{{#foundObjects}}
	<div>
		<div class="col-md-10 col-md-offset-1">
			<h1 class="page-header">{{ className }}</h1>
			<a class="thumbnail"  href="{{extractedImageUrl}}" target="_blank">
				<img src="{{extractedImageUrl}}">
			</a>
			
			<div class="panel panel-default">
			  <div class="panel-heading">Similar Images</div>
			  <div class="panel-body">
			    
				{{#similarImagesPaths}}
				<div class="col-md-2">
					<a href="{{.}}" target="_blank" class="thumbnail">
					<img src="{{.}}">
					</a>
				</div>
				{{/similarImagesPaths}}
			  </div>
			</div>
		</div>
	</div>
	{{/foundObjects}}
		
	</script>
	
</head>

<body>
	<div class="row">
		<div class="col-md-6 col-md-offset-3">
			<div class="text-center">
				<h1 class="">The4Ms</h1>
				<h2 class=""><small>Image Content Search</small></h2>
			</div>
			<form id='searchForm' onsubmit="return onSubmitSearch()">
				<div class="input-group">
			   		<input type="file" class="form-control" name="image" id="image" type="file" ">
			   		<span class="input-group-btn">
			     		<button class="btn btn-default" type="submit">Search</button>
			   		</span>
			 	</div>
			</form>
	  </div>
	</div>
	
	<div id="results">
	</div>
</body>
</html>
