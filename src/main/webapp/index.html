<html>
<head>
	<script src="search-request.js"></script>
	<script src="search-results.js"></script>
	<script src="image-split.js"></script>
	
	<script>
		function onSubmitSearch(){
			try{
				var imageInputControl = document.getElementById('image');
				var searchImage = new Image();

				loadSearchImageAsDataURI(imageInputControl, searchImage, function(){

					// send request to the server
					doSearchRequest(imageInputControl, function(searchResults){

						// split the objects found in the search image 
						for(var i=0; i<searchResults.foundObjects.length; i++){
							var objectBounds = searchResults.foundObjects[i];
							var splittedImageDataURI = getSubImage(searchImage, objectBounds);

							searchResults.foundObjects[i].extractedImageUrl = splittedImageDataURI;
						}

						showResults(searchResults);
					});
				});
			}
			catch(e){
				console.log(e);
			}
			return false;
		}
	</script>
</head>

<body>
	<h2>Search by image</h2>
	
	<form id='searchForm' onsubmit="return onSubmitSearch()">
		<input name="image" id="image" type="file" size="45" />
		<button type="submit">Search</button>
	</form>

	<div id="results">
	</div>

	<h2>USED IN TESTING THE SERVICE AND WILL BE REMOVED</h2>
	
	<form action="rest/search" method="POST" enctype="multipart/form-data">
		<input name="image" id="image" type="file" size="45" />
		<button type="submit">Search</button>
	</form>
</body>
</html>
